
<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js test</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				background:#000;
				color:#fff;
				padding:0;
				margin:0;
				font-weight: bold;
				overflow:hidden;
			}
			a {color: #0080ff; }
			b { color: lightgreen }
		</style>
	</head>
	<body>

		<script src="..\three.js-master\three.js-master\build\three.js"></script>
		<script src="..\three.js-master\three.js-master\examples\js\libs\stats.min.js"></script>
		<script src="..\three.js-master\three.js-master\examples\js\controls\OrbitControls.js"></script>
		<script src="..\three.js-master\three.js-master\examples\js\loaders\OBJLoader.js"></script>
		<script src="..\three.js-master\three.js-master\examples\js\WebGL.js"></script>
		<script src="..\three.js-master\three.js-master\examples\js\libs\stats.min.js"></script>
		<script src='..\three.js-master\three.js-master\examples\js\libs\dat.gui.min.js'></script>
	

		<script>
			var atomstodrawC = [];
			var atomstodrawBi = [];
			var camera, controls, scene, renderer,cubeCamera;
			var ambientLight, light, r = 0.0;
			THREE.Cache.enabled = true;
			var file = new THREE.FileLoader();
			var lines;
			
			file.load(
				// resource URL
				'points.xyz',
				// onLoad callback
				function ( data ) {
					// output the text to the console
					lines = data.split('\n');
					var line;
					var coordinates = [];
					
					for (var i = 0; i < lines.length; i++){
						line = lines[i].split(' ');
						
						
						if(line.length > 1){
							for(var j=0;j<line.length;j++){
								if(line[j] != ''){
									var point = parseFloat(line[j]);
									if (! isNaN(point)){
										coordinates.push(point);
									}
									else{
										coordinates.push(line[j]);
									}
								}
							}
						}
						if(coordinates[0] == 'C'){
							atomstodrawC.push(coordinates);
						}
						if(coordinates[0] == 'Bi'){
							atomstodrawBi.push(coordinates);
						}
						
						coordinates = [];
					}
					
					init();
					animate();
				},				
				// onProgress callback
				function ( xhr ) {
					console.log( (xhr.loaded / xhr.total * 100) + '% loaded' );
				},
				// onError callback
				function ( err ) {
					console.error( 'An error happened loading the file' );
				}
			);
			
			var scene;
			var spotLight;
			
			function init(){	
				console.log(atomstodrawC);
				console.log(atomstodrawBi);
				
				var SCREEN_WIDTH = window.innerWidth;
				var SCREEN_HEIGHT = window.innerHeight;
				
				var container = document.createElement( 'div' );
				document.body.appendChild( container );
				renderer = new THREE.WebGLRenderer();
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				container.appendChild( renderer.domElement );
					
				scene = new THREE.Scene();
				var aspect = SCREEN_WIDTH / SCREEN_HEIGHT;
					
				camera = new THREE.PerspectiveCamera( 45, aspect, 2, 10000 );
				camera.position.set( 10, 10, 30 );
				camera.lookAt( scene.position );

				cubeCamera = new THREE.CubeCamera( 1, 10000, 128 );

				controls = new THREE.OrbitControls( camera, renderer.domElement );
				controls.enableZoom = true;
				controls.enableDamping = true;
				controls.update();						
				ambientLight = new THREE.AmbientLight(0x000000);
				scene.add(ambientLight);
				
				var light = new THREE.DirectionalLight( 0xffffff, 0.8 );
				light.position.set(1,1,1);
				scene.add( light );


				var params = {
					'C color': 0xffff00,
					'Bi color':0xff0000,
					'C roughness': 0.0,
					'C metalness': 0.0,
					'Bi roughness':0.0,
					'Bi metalness':0.0
				};

				
				var geometry = new THREE.SphereGeometry( 0.4, 32, 32 );
				var material = new THREE.MeshStandardMaterial( {color: 0xffff00, metalness:params.metalness, roughness:params.roughness} );
				var sphere = new THREE.Mesh( geometry, material );
				scene.add( sphere );

				var geometry2 = new THREE.SphereGeometry( 0.4, 32, 32 );
				var material2 = new THREE.MeshStandardMaterial( {color: 0xff0000, metalness:params.metalness, roughness:params.roughness} );
				var sphere2 = new THREE.Mesh( geometry2, material2 );
				scene.add( sphere2 );
				
				
				for(var i=1;i<atomstodrawC.length;i++){
					var duplicate = new THREE.Mesh(sphere.geometry, sphere.material);
					duplicate.position.set(atomstodrawC[i][1],atomstodrawC[i][2],atomstodrawC[i][3]);
					duplicate.add(cubeCamera);
					scene.add(duplicate);
				}

				for(var i=1;i<atomstodrawBi.length;i++){
					var duplicate = new THREE.Mesh(sphere2.geometry, sphere2.material);
					duplicate.position.set(atomstodrawBi[i][1],atomstodrawBi[i][2],atomstodrawBi[i][3]);
					duplicate.add(cubeCamera);
					scene.add(duplicate);
				}

				var gui = new dat.GUI();
				
				gui.addColor( params, 'C color' ).onChange( function ( val ) {
					sphere.material.color.setHex( val );
				} );
				gui.addColor( params, 'Bi color' ).onChange( function ( val ) {
					sphere2.material.color.setHex( val );
				} );
				
				gui.add( params, "C metalness" ).min( 0 ).max( 1 ).onChange( function ( value ) {
					material.metalness = value;
				} );
				gui.add( params, "C roughness" ).min( 0 ).max( 1 ).onChange( function ( value ) {
					material.roughness = value;
				} );
				gui.add( params, "Bi metalness" ).min( 0 ).max( 1 ).onChange( function ( value ) {
					material2.metalness = value;
				} );
				
				gui.add( params, "Bi roughness" ).min( 0 ).max( 1 ).onChange( function ( value ) {
					material2.roughness = value;
				} );
				

				gui.open();

					
				renderer.setClearColor( 0x000000, 1);
				renderer.render( scene, camera );
			}
			function animate(){
				requestAnimationFrame( animate );
				
				/*light.position.x = 20 * Math.cos( r );
				light.position.z = 20 * Math.sin( r );
				r += 0.01; */
				controls.update();
				cubeCamera.update( renderer, scene );
				renderer.render( scene, camera );
			}
			
			
		</script>

	</body>
</html>
